<?xml version="1.0"?>
 
<PropertyList>

	<!-- Heading hold --> 
	
	<pi-simple-controller>
		<name>cdi-integrator</name>
		<debug>false</debug>
		<config>
			<Kp>45.0</Kp>
			<Ki>0.40</Ki>
		</config>
		<input>/instruments/nav[0]/heading-needle-deflection</input>
		<output>/autopilot/internal/course-error-deg</output>
		<min>-45.0</min>
		<max>45.0</max>
	</pi-simple-controller>
	
	<filter>
		<name>Intercept Heading Computer</name>
		<debug>false</debug>
		<type>gain</type>
		<gain>1.0</gain>
		<input>/instrumentation/nav[0]/radials/selected-deg</input>
		<reference>/autopilot/internal/course-error-deg</reference>
		<output>/autopilot/internal/intercept-heading-deg</output>
		<period>
			<min>0</min>
			<max>360</max>
		</period>
	</filter>
 
	<filter>
		<name>Heading Offset Computer</name>
		<debug>false</debug>
		<type>gain</type>
		<gain>1.0</gain>
		<input>
			<condition>
				<equals>
					<property>/autopilot/locks/heading</property>
					<value>nav1-hold</value>
				</equals>
			</condition>
			<property>/autopilot/internal/intercept-heading-deg</property>
		</input>
		<input>/autopilot/settings/heading-bug-deg</input>
		<reference>/orientation/heading-magnetic-deg</reference>
		<output>/autopilot/internal/heading-offset-deg</output>
		<period>
			<min>-180</min>
			<max>180</max>
		</period>
	</filter>
	
	<filter>
		<name>Target Roll Computer</name>
		<debug>false</debug>
		<enable>
			<condition>
				<or>
					<equals>
						<property>/autopilot/locks/heading</property>
						<value>dg-heading-hold</value>
					</equals>
					<equals>
						<property>/autopilot/locks/heading</property>
						<value>nav1-hold</value>
					</equals>
				</or>
			</condition>
		</enable>
		<type>gain</type>
		<input>/autopilot/internal/heading-offset-deg</input>
		<output>/autopilot/internal/target-roll-deg</output>
		<gain>2.5</gain>
		<min>
			<property>/autopilot/settings/bank-limit</property>
			<scale>-1.0</scale>
		</min>
		<max>/autopilot/settings/bank-limit</max>
	</filter>
	
	<pid-controller>
		<name>Heading Hold</name>
		<debug>false</debug>
		<enable>
			<condition>
				<or>
					<equals>
						<property>/autopilot/locks/heading</property>
						<value>dg-heading-hold</value>
					</equals>
					<equals>
						<property>/autopilot/locks/heading</property>
						<value>nav1-hold</value>
					</equals>
				</or>
			</condition>
		</enable>
		<input>
			<prop>/orientation/roll-deg</prop>
		</input>
		<reference>/autopilot/internal/target-roll-deg</reference>
		<output>
			<prop>/autopilot/internal/aileron-cmd</prop>
		</output>
		<config>
			<Kp>0.005</Kp>
			<Ti>100.0</Ti>
			<Td>0.0</Td>
			<u_min>-1.0</u_min>
			<u_max>1.0</u_max>
		</config>
	</pid-controller>
	
	<filter>
		<name>SERVO-DRIVER:aileron</name>
		<debug>false</debug>
		<feedback-if-disabled>true</feedback-if-disabled>
		<enable>
			<condition>
				<or>
					<equals>
						<property>/autopilot/locks/heading</property>
						<value>dg-heading-hold</value>
					</equals>
					<equals>
						<property>/autopilot/locks/heading</property>
						<value>nav1-hold</value>
					</equals>
				</or>
			</condition>
		</enable>
		<input>/autopilot/internal/aileron-cmd</input>
		<output>/controls/flight/aileron</output>
		<type>noise-spike</type>
		<max-rate-of-change>0.08</max-rate-of-change>
	</filter>
	
	<!-- Pitch hold -->
	
	<pid-controller>
		<name>Pitch hold</name>
		<debug>false</debug>
		<enable>
			<condition>
				<or>
					<equals>
						<property>/autopilot/locks/altitude</property>
						<value>pitch-hold</value>
					</equals>
					<equals>
						<property>/autopilot/locks/altitude</property>
						<value>altitude-hold</value>
					</equals>
				</or>
			</condition>
		</enable>
		<input>
			<prop>/orientation/pitch-deg</prop>
		</input>
		<reference>
			<prop>/autopilot/settings/target-pitch-deg</prop>
		</reference>
		<output>
			<prop>/autopilot/internal/elevator-cmd</prop>
		</output>
		<config>
			<Kp>-0.05</Kp>
			<Ti>100.0</Ti>
			<Td>0.0</Td>
			<u_min>-1.0</u_min>
			<u_max>1.0</u_max>
		</config>
	</pid-controller>
	
	<filter>
		<name>SERVO-DRIVER:elevator</name>
		<debug>false</debug>
		<feedback-if-disabled>true</feedback-if-disabled>
		<enable>
			<condition>
				<or>
					<equals>
						<property>/autopilot/locks/altitude</property>
						<value>pitch-hold</value>
					</equals>
					<equals>
						<property>/autopilot/locks/altitude</property>
						<value>altitude-hold</value>
					</equals>
				</or>
			</condition>
		</enable>
		<input>/autopilot/internal/elevator-cmd</input>
		<output>/controls/flight/elevator</output>
		<type>noise-spike</type>
		<max-rate-of-change>0.08</max-rate-of-change>
	</filter>
	
	<!-- Vertical speed hold -->
	
	<filter>
		<name>AP:Pitch sample and hold</name>
		<debug>false</debug>
		<enable>
			<condition>
				<not>
					<property>/autopilot/locks/roc-lock</property>
				</not>
			</condition>
		</enable>
		<type>gain</type>
		<gain>1.0</gain>
		<input>/orientation/pitch-deg</input>
		<output>/autopilot/internal/target-pitch-deg</output>
	</filter>
	
	<pid-controller>
		<name>Vertical speed pitch hold</name>
		<debug>false</debug>
		<enable>
			<condition>
				<property>/autopilot/locks/roc-lock</property>
			</condition>
		</enable>
		<input>
			<prop>/autopilot/internal/vert-speed-fpm</prop>
		</input>
		<reference>/autopilot/settings/vertical-speed-fpm</reference>
		<output>
			<prop>/autopilot/settings/target-pitch-deg</prop>
		</output>
		<config>
			<Kp>0.001</Kp>
			<Ti>10.0</Ti>
			<Td>0.0</Td>
			<u_min>-10.0</u_min>
			<u_max>10.0</u_max>
		</config>
	</pid-controller>
	
	<!-- Altitude hold -->
	
	<filter>
		<name>Target Rate of Climb Computer (ALT HOLD)</name>
		<debug>false</debug>
		<enable>
			<prop>/autopilot/locks/altitude</prop>
			<value>altitude-hold</value>
		</enable>
		<type>gain</type>
		<input>position/altitude-ft</input>
		<reference>autopilot/settings/target-altitude-ft</reference>
		<gain>-1.0</gain> <!-- 100ft offset gives 500fpm roc -->
		<output>autopilot/internal/target-roc-fpm</output>
		<min>-1800</min>
		<max>1800</max>
	</filter>
	
	<pid-controller>
		<name>Target Pitch Computer (ALT HOLD)</name>
		<debug>false</debug>
		<enable>
			<condition>
				<property>/autopilot/locks/roc-lock</property>
			</condition>
		</enable>
		<input>
			<prop>/autopilot/internal/vert-speed-fpm</prop>
		</input>
		<reference>/autopilot/internal/target-roc-fpm</reference>
		<output>
			<prop>/autopilot/settings/target-pitch-deg</prop>
		</output>
		<config>
			<Kp>0.001</Kp>
			<Ti>10.0</Ti>
			<Td>0.0</Td>
			<u_min>-10.0</u_min>
			<u_max>10.0</u_max>
		</config>
	</pid-controller>
	
	<!-- Auto throttle -->
	<pid-controller>
        <name>Auto throttle (IAS)</name>
        <debug>false</debug>
        <enable>
			<prop>/autopilot/locks/speed</prop>
			<value>speed-with-throttle-ias</value>
        </enable>
        <input>
            <prop>/instrumentation/airspeed-indicator/indicated-speed-kt</prop>
        </input>
        <reference>
            <prop>/autopilot/settings/target-speed-kt</prop>
        </reference>
        <output>
            <prop>/autopilot/internal/throttle-cmd</prop>
        </output>
        <config>
            <Kp>0.15</Kp>
            <Ti>20.0</Ti>
            <Td>0.00001</Td>
            <u_min>0.0</u_min>
            <u_max>1.0</u_max>
        </config>
	</pid-controller>
	
	<pid-controller>
        <name>Auto throttle (MACH)</name>
        <debug>false</debug>
        <enable>
			<prop>/autopilot/locks/speed</prop>
			<value>speed-with-throttle-mach</value>
        </enable>
        <input>
            <prop>/instrumentation/airspeed-indicator/indicated-mach</prop>
        </input>
        <reference>
            <prop>/autopilot/settings/target-speed-mach</prop>
        </reference>
        <output>
            <prop>/autopilot/internal/throttle-cmd</prop>
        </output>
        <config>
            <Kp>150</Kp>
            <Ti>20.0</Ti>
            <Td>0.00001</Td>
            <u_min>0.0</u_min>
            <u_max>1.0</u_max>
        </config>
	</pid-controller>
	
	<filter>
		<name>SERVO-DRIVER:throttle-ias</name>
		<debug>false</debug>
		<feedback-if-disabled>true</feedback-if-disabled>
		<enable>
			<condition>
				<or>
					<equals>
						<property>/autopilot/locks/speed</property>
						<value>speed-with-throttle-ias</value>
					</equals>
					<equals>
						<property>/autopilot/locks/speed</property>
						<value>speed-with-throttle-mach</value>
					</equals>
				</or>
			</condition>
		</enable>
		<input>/autopilot/internal/throttle-cmd</input>
		<output>
			<prop>/controls/engines/engine[0]/throttle</prop>
			<prop>/controls/engines/engine[1]/throttle</prop>
			<prop>/controls/engines/engine[2]/throttle</prop>
			<prop>/controls/engines/engine[3]/throttle</prop>
		</output>
		<type>noise-spike</type>
		<max-rate-of-change>0.1</max-rate-of-change>
	</filter>
  
</PropertyList>
