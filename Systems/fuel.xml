<?xml version="1.0"?>

<system name="fuel">
	<!--
	<property>/controls/fuel/tank[1]/x-feed</property>
	<property>/controls/fuel/tank[2]/x-feed</property>
	<property>/controls/fuel/tank[3]/x-feed</property>
	<property>/controls/fuel/tank[4]/x-feed</property>
	<property>/controls/fuel/tank[7]/pump</property>
	<property>/controls/fuel/dump-valve</property>
	-->
	<property>/controls/fuel/fuel-to-remain</property>

	<channel name="fuel">

		<!-- from CWT to MAIN #2 -->
		<switch>
			<default value="0"/>
			<test logic="AND" value="25">
				propulsion/tank[0]/contents-lbs gt 0
				propulsion/tank[2]/contents-lbs lt 59965
			</test>
			<output>propulsion/tank[0]/external-flow-rate/tank[2]</output>
		</switch>
		<!-- from CWT to MAIN #3 -->
		<switch>
			<default value="0"/>
			<test logic="AND" value="25">
				propulsion/tank[0]/contents-lbs gt 0
				propulsion/tank[3]/contents-lbs lt 59965
			</test>
			<output>propulsion/tank[0]/external-flow-rate/tank[3]</output>
		</switch>
		<!-- JETTISON -->
		<switch>
			<default value="0"/>
			<test logic="AND" value="25">
				/controls/fuel/dump-valve == 1
				propulsion/total-fuel-lbs gt /controls/fuel/fuel-to-remain
			</test>
			<output>propulsion/tank[0]/external-flow-rate/jettison</output>
			<output>propulsion/tank[7]/external-flow-rate/jettison</output>
		</switch>
		<switch>
			<default value="0"/>
			<test logic="AND" value="25">
				/controls/fuel/dump-valve == 1
				propulsion/total-fuel-lbs gt /controls/fuel/fuel-to-remain
				propulsion/tank[2]/contents-lbs gt 7055
			</test>
			<output>propulsion/tank[2]/external-flow-rate/jettison</output>
		</switch>
		<switch>
			<default value="0"/>
			<test logic="AND" value="25">
				/controls/fuel/dump-valve == 1
				propulsion/total-fuel-lbs gt /controls/fuel/fuel-to-remain
				propulsion/tank[3]/contents-lbs gt 7055
			</test>
			<output>propulsion/tank[3]/external-flow-rate/jettison</output>
		</switch>
		<summer>
			<input>propulsion/tank[0]/external-flow-rate/jettison</input>
			<input>propulsion/tank[2]/external-flow-rate/jettison</input>
			<input>propulsion/tank[3]/external-flow-rate/jettison</input>
			<input>propulsion/tank[7]/external-flow-rate/jettison</input>
			<output>propulsion/fuel-dump-rate-pps</output>
		</summer>
		<fcs_function name="propulsion/fuel-dump-time-sec">
			<function>
				<quotient>
					<sum>
						<property>propulsion/total-fuel-lbs</property>
						<product>
							<value>-1</value>
							<property>/controls/fuel/fuel-to-remain</property>
						</product>
					</sum>
					<sum>
						<property>propulsion/tank[0]/external-flow-rate/jettison</property>
						<property>propulsion/tank[2]/external-flow-rate/jettison</property>
						<property>propulsion/tank[3]/external-flow-rate/jettison</property>
						<property>propulsion/tank[7]/external-flow-rate/jettison</property>
					</sum>
				</quotient>
			</function>
		</fcs_function>

		<!-- from MAIN #1 to MAIN #2 -->
		<switch>
			<default value="0"/>
			<test logic="AND" value="25">
				/controls/fuel/tank[1]/x-feed == 1
				/controls/fuel/tank[2]/x-feed == 1
				propulsion/tank[1]/contents-lbs gt propulsion/tank[2]/contents-lbs
				propulsion/tank[1]/contents-lbs gt 7050
				propulsion/tank[2]/contents-lbs lt 84057.9
			</test>
			<output>propulsion/tank[1]/external-flow-rate/tank[2]</output>
		</switch>
		<!-- from MAIN #2 to MAIN #1 -->
		<switch>
			<default value="0"/>
			<test logic="AND" value="25">
				/controls/fuel/tank[1]/x-feed == 1
				/controls/fuel/tank[2]/x-feed == 1
				propulsion/tank[1]/contents-lbs lt propulsion/tank[2]/contents-lbs
				propulsion/tank[1]/contents-lbs lt 30028.9
				propulsion/tank[2]/contents-lbs gt 0
			</test>
			<output>propulsion/tank[2]/external-flow-rate/tank[1]</output>
		</switch>
		<!-- from MAIN #3 to MAIN #4 -->
		<switch>
			<default value="0"/>
			<test logic="AND" value="25">
				/controls/fuel/tank[3]/x-feed == 1
				/controls/fuel/tank[4]/x-feed == 1
				propulsion/tank[4]/contents-lbs lt propulsion/tank[3]/contents-lbs
				propulsion/tank[3]/contents-lbs gt 0
				propulsion/tank[4]/contents-lbs lt 30028.9
			</test>
			<output>propulsion/tank[3]/external-flow-rate/tank[4]</output>
		</switch>
		<!-- from MAIN #4 to MAIN #3 -->
		<switch>
			<default value="0"/>
			<test logic="AND" value="25">
				/controls/fuel/tank[3]/x-feed == 1
				/controls/fuel/tank[4]/x-feed == 1
				propulsion/tank[4]/contents-lbs gt propulsion/tank[3]/contents-lbs
				propulsion/tank[3]/contents-lbs lt 84057.9
				propulsion/tank[4]/contents-lbs gt 7050
			</test>
			<output>propulsion/tank[4]/external-flow-rate/tank[3]</output>
		</switch>
		<!-- from RESERVE #2 to MAIN 2 -->
		<switch>
			<default value="0"/>
			<test logic="AND" value="25">
				propulsion/tank[5]/contents-lbs gt 0.0
				propulsion/tank[2]/contents-lbs lt 40100.0
			</test>
			<output>propulsion/tank[5]/external-flow-rate/tank[2]</output>
		</switch>
		<!-- from RESERVE #3 to MAIN 3 -->
		<switch>
			<default value="0"/>
			<test logic="AND" value="25">
				propulsion/tank[6]/contents-lbs gt 0.0
				propulsion/tank[3]/contents-lbs lt 40100.0
			</test>
			<output>propulsion/tank[6]/external-flow-rate/tank[3]</output>
		</switch>
		<!-- from STAB to CWT -->
		<switch>
			<default value="0"/>
			<test logic="AND" value="25">
				propulsion/tank[0]/contents-lbs lt 80400.0
				propulsion/tank[7]/contents-lbs gt 0.0
				/controls/fuel/tank[7]/pump == 1
			</test>
			<output>propulsion/tank[7]/external-flow-rate/tank[0]</output>
		</switch>

		<summer>
			<input>-propulsion/tank[0]/external-flow-rate/jettison</input>
			<!--<input>-propulsion/tank[0]/external-flow-rate/tank[1]</input>-->
			<input>-propulsion/tank[0]/external-flow-rate/tank[2]</input>
			<input>-propulsion/tank[0]/external-flow-rate/tank[3]</input>
			<!--<input>-propulsion/tank[0]/external-flow-rate/tank[4]</input>
			<input>-propulsion/tank[0]/external-flow-rate/tank[5]</input>
			<input>-propulsion/tank[0]/external-flow-rate/tank[6]</input>
			<input>-propulsion/tank[0]/external-flow-rate/tank[7]</input>
			<input>propulsion/tank[1]/external-flow-rate/tank[0]</input>
			<input>propulsion/tank[2]/external-flow-rate/tank[0]</input>
			<input>propulsion/tank[3]/external-flow-rate/tank[0]</input>
			<input>propulsion/tank[4]/external-flow-rate/tank[0]</input>
			<input>propulsion/tank[5]/external-flow-rate/tank[0]</input>
			<input>propulsion/tank[6]/external-flow-rate/tank[0]</input>-->
			<input>propulsion/tank[7]/external-flow-rate/tank[0]</input>
			<output>propulsion/tank[0]/external-flow-rate-pps</output>
		</summer>
		
		<summer>
			<!--<input>-propulsion/tank[1]/external-flow-rate/tank[0]</input>-->
			<input>-propulsion/tank[1]/external-flow-rate/tank[2]</input>
			<!--<input>-propulsion/tank[1]/external-flow-rate/tank[3]</input>
			<input>-propulsion/tank[1]/external-flow-rate/tank[4]</input>
			<input>-propulsion/tank[1]/external-flow-rate/tank[5]</input>
			<input>-propulsion/tank[1]/external-flow-rate/tank[6]</input>
			<input>-propulsion/tank[1]/external-flow-rate/tank[7]</input>
			<input>propulsion/tank[0]/external-flow-rate/tank[1]</input>-->
			<input>propulsion/tank[2]/external-flow-rate/tank[1]</input>
			<!--<input>propulsion/tank[3]/external-flow-rate/tank[1]</input>
			<input>propulsion/tank[4]/external-flow-rate/tank[1]</input>
			<input>propulsion/tank[5]/external-flow-rate/tank[1]</input>
			<input>propulsion/tank[6]/external-flow-rate/tank[1]</input>
			<input>propulsion/tank[7]/external-flow-rate/tank[1]</input>-->
			<output>propulsion/tank[1]/external-flow-rate-pps</output>
		</summer>
		
		<summer>
			<input>-propulsion/tank[2]/external-flow-rate/jettison</input>
			<!--<input>-propulsion/tank[2]/external-flow-rate/tank[0]</input>-->
			<input>-propulsion/tank[2]/external-flow-rate/tank[1]</input>
			<!--<input>-propulsion/tank[2]/external-flow-rate/tank[3]</input>
			<input>-propulsion/tank[2]/external-flow-rate/tank[4]</input>
			<input>-propulsion/tank[2]/external-flow-rate/tank[5]</input>
			<input>-propulsion/tank[2]/external-flow-rate/tank[6]</input>
			<input>-propulsion/tank[2]/external-flow-rate/tank[7]</input>-->
			<input>propulsion/tank[0]/external-flow-rate/tank[2]</input>
			<input>propulsion/tank[1]/external-flow-rate/tank[2]</input>
			<!--<input>propulsion/tank[3]/external-flow-rate/tank[2]</input>
			<input>propulsion/tank[4]/external-flow-rate/tank[2]</input>-->
			<input>propulsion/tank[5]/external-flow-rate/tank[2]</input>
			<!--<input>propulsion/tank[6]/external-flow-rate/tank[2]</input>
			<input>propulsion/tank[7]/external-flow-rate/tank[2]</input>-->
			<output>propulsion/tank[2]/external-flow-rate-pps</output>
		</summer>
		
		<summer>
			<input>-propulsion/tank[3]/external-flow-rate/jettison</input>
			<!--<input>-propulsion/tank[3]/external-flow-rate/tank[0]</input>
			<input>-propulsion/tank[3]/external-flow-rate/tank[1]</input>
			<input>-propulsion/tank[3]/external-flow-rate/tank[2]</input>-->
			<input>-propulsion/tank[3]/external-flow-rate/tank[4]</input>
			<!--<input>-propulsion/tank[3]/external-flow-rate/tank[5]</input>
			<input>-propulsion/tank[3]/external-flow-rate/tank[6]</input>
			<input>-propulsion/tank[3]/external-flow-rate/tank[7]</input>-->
			<input>propulsion/tank[0]/external-flow-rate/tank[3]</input>
			<!--<input>propulsion/tank[1]/external-flow-rate/tank[3]</input>
			<input>propulsion/tank[2]/external-flow-rate/tank[3]</input>-->
			<input>propulsion/tank[4]/external-flow-rate/tank[3]</input>
			<!--<input>propulsion/tank[5]/external-flow-rate/tank[3]</input>-->
			<input>propulsion/tank[6]/external-flow-rate/tank[3]</input>
			<!--<input>propulsion/tank[7]/external-flow-rate/tank[3]</input>-->
			<output>propulsion/tank[3]/external-flow-rate-pps</output>
		</summer>
		
		<summer>
			<!--<input>-propulsion/tank[4]/external-flow-rate/tank[0]</input>
			<input>-propulsion/tank[4]/external-flow-rate/tank[1]</input>
			<input>-propulsion/tank[4]/external-flow-rate/tank[2]</input>-->
			<input>-propulsion/tank[4]/external-flow-rate/tank[3]</input>
			<!--<input>-propulsion/tank[4]/external-flow-rate/tank[5]</input>
			<input>-propulsion/tank[4]/external-flow-rate/tank[6]</input>
			<input>-propulsion/tank[4]/external-flow-rate/tank[7]</input>
			<input>propulsion/tank[0]/external-flow-rate/tank[4]</input>
			<input>propulsion/tank[1]/external-flow-rate/tank[4]</input>
			<input>propulsion/tank[2]/external-flow-rate/tank[4]</input>-->
			<input>propulsion/tank[3]/external-flow-rate/tank[4]</input>
			<!--<input>propulsion/tank[5]/external-flow-rate/tank[4]</input>
			<input>propulsion/tank[6]/external-flow-rate/tank[4]</input>
			<input>propulsion/tank[7]/external-flow-rate/tank[4]</input>-->
			<output>propulsion/tank[4]/external-flow-rate-pps</output>
		</summer>
		
		<summer>
			<!--<input>-propulsion/tank[5]/external-flow-rate/tank[0]</input>
			<input>-propulsion/tank[5]/external-flow-rate/tank[1]</input>-->
			<input>-propulsion/tank[5]/external-flow-rate/tank[2]</input>
			<!--<input>-propulsion/tank[5]/external-flow-rate/tank[3]</input>
			<input>-propulsion/tank[5]/external-flow-rate/tank[4]</input>
			<input>-propulsion/tank[5]/external-flow-rate/tank[6]</input>
			<input>-propulsion/tank[5]/external-flow-rate/tank[7]</input>
			<input>propulsion/tank[0]/external-flow-rate/tank[5]</input>
			<input>propulsion/tank[1]/external-flow-rate/tank[5]</input>
			<input>propulsion/tank[2]/external-flow-rate/tank[5]</input>
			<input>propulsion/tank[3]/external-flow-rate/tank[5]</input>
			<input>propulsion/tank[4]/external-flow-rate/tank[5]</input>
			<input>propulsion/tank[6]/external-flow-rate/tank[5]</input>
			<input>propulsion/tank[7]/external-flow-rate/tank[5]</input>-->
			<output>propulsion/tank[5]/external-flow-rate-pps</output>
		</summer>
		
		<summer>
			<!--<input>-propulsion/tank[6]/external-flow-rate/tank[0]</input>
			<input>-propulsion/tank[6]/external-flow-rate/tank[1]</input>
			<input>-propulsion/tank[6]/external-flow-rate/tank[2]</input>-->
			<input>-propulsion/tank[6]/external-flow-rate/tank[3]</input>
			<!--<input>-propulsion/tank[6]/external-flow-rate/tank[4]</input>
			<input>-propulsion/tank[6]/external-flow-rate/tank[5]</input>
			<input>-propulsion/tank[6]/external-flow-rate/tank[7]</input>
			<input>propulsion/tank[0]/external-flow-rate/tank[6]</input>
			<input>propulsion/tank[1]/external-flow-rate/tank[6]</input>
			<input>propulsion/tank[2]/external-flow-rate/tank[6]</input>
			<input>propulsion/tank[3]/external-flow-rate/tank[6]</input>
			<input>propulsion/tank[4]/external-flow-rate/tank[6]</input>
			<input>propulsion/tank[5]/external-flow-rate/tank[6]</input>
			<input>propulsion/tank[7]/external-flow-rate/tank[6]</input>-->
			<output>propulsion/tank[6]/external-flow-rate-pps</output>
		</summer>
		
		<summer>
			<input>-propulsion/tank[7]/external-flow-rate/jettison</input>
			<input>-propulsion/tank[7]/external-flow-rate/tank[0]</input>
			<!--<input>-propulsion/tank[7]/external-flow-rate/tank[1]</input>
			<input>-propulsion/tank[7]/external-flow-rate/tank[2]</input>
			<input>-propulsion/tank[7]/external-flow-rate/tank[3]</input>
			<input>-propulsion/tank[7]/external-flow-rate/tank[4]</input>
			<input>-propulsion/tank[7]/external-flow-rate/tank[5]</input>
			<input>-propulsion/tank[7]/external-flow-rate/tank[6]</input>
			<input>propulsion/tank[0]/external-flow-rate/tank[7]</input>
			<input>propulsion/tank[1]/external-flow-rate/tank[7]</input>
			<input>propulsion/tank[2]/external-flow-rate/tank[7]</input>
			<input>propulsion/tank[3]/external-flow-rate/tank[7]</input>
			<input>propulsion/tank[4]/external-flow-rate/tank[7]</input>
			<input>propulsion/tank[5]/external-flow-rate/tank[7]</input>
			<input>propulsion/tank[7]/external-flow-rate/tank[7]</input>-->
			<output>propulsion/tank[7]/external-flow-rate-pps</output>
		</summer>
	   
    </channel>
	
</system>
